<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="SYS_FUNC_INFO" >
  <resultMap id="SysFuncInfoResult" class="com.synesoft.fisp.domain.model.SysFuncInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri Nov 15 18:58:10 CST 2013.
    -->
    <result column="FUNC_ID" property="funcId" jdbcType="VARCHAR" />
    <result column="FUNC_DESC" property="funcDesc" jdbcType="VARCHAR" />
    <result column="FUNC_I18N" property="funcI18n" jdbcType="VARCHAR" />
    <result column="SUP_FUNC_ID" property="supFuncId" jdbcType="VARCHAR" />
    <result column="FUNC_LVL" property="funcLvl" jdbcType="DECIMAL" />
    <result column="FUNC_URL" property="funcUrl" jdbcType="VARCHAR" />
    <result column="FUNC_PARA" property="funcPara" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="CHAR" />
    <result column="CREATE_USER" property="createUser" jdbcType="VARCHAR" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="CHAR" />
    <result column="UPDATE_USER" property="updateUser" jdbcType="VARCHAR" />
    <result column="RSV1" property="rsv1" jdbcType="VARCHAR" />
    <result column="RSV2" property="rsv2" jdbcType="VARCHAR" />
    <result column="RSV3" property="rsv3" jdbcType="VARCHAR" />
    <result column="RSV4" property="rsv4" jdbcType="VARCHAR" />
    <result column="RSV5" property="rsv5" jdbcType="VARCHAR" />
  </resultMap>
  <select id="selectByPrimaryKey" resultMap="SysFuncInfoResult" parameterClass="com.synesoft.fisp.domain.model.SysFuncInfo" >
    select FUNC_ID, FUNC_DESC, FUNC_I18N, SUP_FUNC_ID, FUNC_LVL, FUNC_URL, FUNC_PARA, CREATE_TIME,
      CREATE_USER, UPDATE_TIME, UPDATE_USER, RSV1, RSV2, RSV3, RSV4, RSV5
    from SYS_FUNC_INFO
  </select>
  <!-- 获取用户一级菜单  -->
   <select id="selectFirstMenus" resultMap="SysFuncInfoResult"  parameterClass="java.util.HashMap" >
    select FUNC_ID, FUNC_DESC, FUNC_I18N, SUP_FUNC_ID, FUNC_LVL, FUNC_URL, FUNC_PARA, CREATE_TIME,
      CREATE_USER, UPDATE_TIME, UPDATE_USER, RSV1, RSV2, RSV3, RSV4, RSV5
    from SYS_FUNC_INFO
    where SUP_FUNC_ID is null
    and FUNC_ID in ($funcIds$) order by FUNC_LVL
  </select>
  <!-- 获取用户二级菜单  -->
    <select id="selectSecondMenus" resultMap="SysFuncInfoResult"  parameterClass="java.util.HashMap" >
    select FUNC_ID, FUNC_DESC, FUNC_I18N, SUP_FUNC_ID, FUNC_LVL, FUNC_URL, FUNC_PARA, CREATE_TIME,
      CREATE_USER, UPDATE_TIME, UPDATE_USER, RSV1, RSV2, RSV3, RSV4, RSV5
    from SYS_FUNC_INFO
    where SUP_FUNC_ID =#supFuncId:VARCHAR#
    and FUNC_ID in ($funcIds$) order by FUNC_LVL
  </select>
  <!-- 获取用户三级菜单以及迭代向下的菜单  -->
    <select id="selectThirdMenus" resultMap="SysFuncInfoResult"  parameterClass="java.util.HashMap" >
    select FUNC_ID, FUNC_DESC, FUNC_I18N, SUP_FUNC_ID, FUNC_LVL, FUNC_URL, FUNC_PARA, CREATE_TIME,
      CREATE_USER, UPDATE_TIME, UPDATE_USER, RSV1, RSV2, RSV3, RSV4, RSV5
    from SYS_FUNC_INFO
    where SUP_FUNC_ID =#supFuncId:VARCHAR#
    and FUNC_ID in ($funcIds$) order by FUNC_LVL
  </select>
    <!-- 获取所有一级的菜单  -->
    <select id="selectAllFirMenus" resultMap="SysFuncInfoResult"  >
    select FUNC_ID, FUNC_DESC, FUNC_I18N, SUP_FUNC_ID, FUNC_LVL, FUNC_URL, FUNC_PARA, CREATE_TIME,
      CREATE_USER, UPDATE_TIME, UPDATE_USER, RSV1, RSV2, RSV3, RSV4, RSV5
    from SYS_FUNC_INFO
    where SUP_FUNC_ID is null order by FUNC_LVL
  </select>
      <!-- 根据上级菜单获取所有下级的菜单  -->
    <select id="selectMenusBySupId" resultMap="SysFuncInfoResult" parameterClass="java.util.HashMap" >
    select FUNC_ID, FUNC_DESC, FUNC_I18N, SUP_FUNC_ID, FUNC_LVL, FUNC_URL, FUNC_PARA, CREATE_TIME,
      CREATE_USER, UPDATE_TIME, UPDATE_USER, RSV1, RSV2, RSV3, RSV4, RSV5
    from SYS_FUNC_INFO
    where SUP_FUNC_ID =#supFuncId:VARCHAR# order by FUNC_LVL
  </select>
  <!-- 获取系统菜单  oracle  -->
  <!--  <select id="selectAllMenus"  parameterClass="com.synesoft.fisp.domain.model.UserRoleInf" resultClass="com.synesoft.fisp.domain.model.SysFuncInfo">
    select level,
	       connect_by_isleaf connectbyisleaf,
	       func_id           funcid,
	       func_desc         funcdesc,
	       func_i18n         funci18n,
	       sup_func_id       supfuncid,
	       func_lvl          funclvl,
	       func_url          funcurl,
	       func_para         funcpara
      from (select * 	       
	  from sys_func_info t
	 where exists (select 1
	          from userroleinf ur, sys_role_func rf
	         where trim(ur.roleid) = rf.role_id
	          and t.func_id=rf.func_id
	           and trim(ur.orgid) = #orgid:VARCHAR#
	           and trim(ur.userid) = #userid:VARCHAR#
	           and trim(rf.optstatus) = #optstatus:VARCHAR#
	           and trim(ur.optstatus) = #optstatus:VARCHAR#))
	connect by prior func_id = sup_func_id
	 start with sup_func_id is null
	 order siblings by func_lvl
  </select> -->
  <select id="selectAllMenus"  parameterClass="com.synesoft.fisp.domain.model.UserRoleInf" resultClass="com.synesoft.fisp.domain.model.SysFuncInfo">
    select func_id           funcid,
	       func_desc         funcdesc,
	       func_i18n         funci18n,
	       sup_func_id       supfuncid,
	       func_lvl          funclvl,
	       func_url          funcurl,
	       func_para         funcpara    
	  from sys_func_info t
	 where trim(t.func_id) in (select trim(rf.func_id)
	          from SYS_USER_ROLE_INF ur, sys_role_func rf
	         where trim(ur.roleid) = trim(rf.role_id)
	           and trim(ur.orgid) = #orgid:VARCHAR#
	           and trim(ur.userid) = #userid:VARCHAR#)
	 order by func_lvl asc
  </select>
  
  <select id="selectAllMenusNoOrg"  parameterClass="com.synesoft.fisp.domain.model.UserRoleInf" resultClass="com.synesoft.fisp.domain.model.SysFuncInfo">
    select func_id           funcid,
	       func_desc         funcdesc,
	       func_i18n         funci18n,
	       sup_func_id       supfuncid,
	       func_lvl          funclvl,
	       func_url          funcurl,
	       func_para         funcpara    
	  from sys_func_info t
	 where trim(t.func_id) in (select trim(rf.func_id)
	          from SYS_USER_ROLE ur, sys_role_func rf
	         where trim(ur.roleid) = trim(rf.role_id)
	           and trim(ur.userid) = #userid:VARCHAR#)
	 order by func_lvl asc
  </select> 
</sqlMap>